############################################################
#
#                       TUNE SOFT IOC
#                      RECORD DATABASE
#
############################################################
# INITIALIZATION
#
# Desc: Initialization of devices.

# Reset

record(bo, "$(P)$(R)Rst-Cmd"){
  field(DESC, "Rst IOC parameters")
  field(PINI, "YES")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(HIGH, "2")
  field(VAL, "1")
  field(FLNK, "$(P)$(R)ValidRst")
}

record(calcout, "$(P)$(R)ValidRst"){
  field(DESC, "Validate download cmd")
  field(INPA, "$(P)$(R)Rst-Cmd")
  field(CALC, "A")
  field(OOPT, "When Non-zero")
  field(OUT, "$(P)$(R)InitSeqNoiseGen.PROC PP")
}

# Init Noise Gen parameters

record(sseq, "$(P)$(R)InitSeqNoiseGen"){
  field(DESC, "Init sequence Noise Gen")
  field(SELM, "All")
  field(STR1, "Noise")
  field(LNK1, "$(NOISE_GEN)WfmFunction-Sel PP") # Select 'Noise' function
  field(DLY1,  "0.5")
  field(DO2,  "0.2")
  field(LNK2, "$(NOISE_GEN)Ampl-SP PP")         # Set sanity Amplitude
  field(DO3,  "0.2")
  field(LNK3, "$(NOISE_GEN)Offset-SP PP")       # Set sanity Offset
  field(DO4,  "1000")
  field(LNK4, "$(P)$(R)Span-SP.PROC PP")        # Process span
  field(FLNK, "$(P)$(R)InitSeqCarGen")
}

# Init Carrier Gen parameters

record(sseq, "$(P)$(R)InitSeqCarGen"){
  field(DESC, "Init sequence Car. Generator")
  field(SELM, "All")
  field(DO1, "1")
  field(LNK1, "$(P)$(R)CarFreq-SP.PROC PP")     # Process center freq
  field(FLNK, "$(P)$(R)InitSeqAmp")
}

# Init Amplifier parameters

record(sseq, "$(P)$(R)InitSeqAmp"){
  field(DESC, "Init sequence Amplifier")
  field(SELM, "All")
  field(DO1,  "1")
  field(LNK1, "$(AMP)GainAuto-Sel")             # Lock dBs with steps
  field(DLY1,  "0.5")
  field(DO2,  "32")
  field(LNK2, "$(P)$(R)Gain-SP PP")             # Set minimal Gain
  field(FLNK, "$(P)$(R)InitSeqSpecAna")
}

# Init Spectrum Analyzer parameters

record(sseq, "$(P)$(R)InitSeqSpecAna"){
  field(DESC, "Init sequence Spec. Analyzer")
  field(SELM, "All")
  field(STR1, "OFF")
  field(LNK1, "$(SPEC_ANA)EnblOutp-Sel PP")            # Set Tracking Generator to OFF
  field(DLY1,  "0.5")
  field(STR2, "FFT")
  field(LNK2, "$(SPEC_ANA)FiltType-Sel PP")            # Set mode to FFT
  field(STR3, "ON")
  field(LNK3, "$(SPEC_ANA)EnblSweTimeAuto-Sel PP")     # Set Time Coupling
  field(STR4, "ON")
  field(LNK4, "$(SPEC_ANA)EnblAttAuto-Sel PP")         # Enable Ref. Level Att.
  field(STR5, "300 kHz")
  field(LNK5, "$(SPEC_ANA)Rbw-Sel PP")                 # Resolution bandwidth
  field(DLY5,  "0.5")
  field(STR6, "ON")
  field(LNK6, "$(SPEC_ANA)GetSpectrum-Sel PP")         # Turn acquisition on
  field(FLNK, "$(P)$(R)InitSeqEnbl")
}

# Power Excitation

record(sseq, "$(P)$(R)InitSeqEnbl"){
  field(DESC, "Init sequence Enable")
  field(DO1, "1")
  field(LNK1, "$(P)$(R)Enbl-Sel.PROC PP")              # Enable Excitation
  field(SELM, "All")
}
